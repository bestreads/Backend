openapi: 3.0.0
info:
  title: Best Reads API
  description: API for searching and managing books
  version: 1.0.0
  contact:
    name: Best Reads Team

servers:
  - url: http://localhost:8080/api/v1
    description: Development server
  - url: https://bestreads.byte-flow.de/api/v1/
    description: Production server

tags:
  - name: Books
    description: Book search and management operations
  - name: User
    description: User management operations
  - name: Health
    description: System health check

paths:
  /books/search:
    get:
      summary: Search for books
      description: |
        Search for books in the local database. If no results are found locally, 
        the API will query the Open Library API to provide additional results.
      operationId: searchBooks
      tags:
        - Books
      parameters:
        - name: q
          in: query
          description: Search query string (searches in title, author, and description)
          required: true
          schema:
            type: string
            example: harry potter
        - name: limit
          in: query
          description: Maximum number of results to return (default 10 from Open Library)
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Successful search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Book'
              examples:
                localResults:
                  summary: Results from local database
                  value:
                    - id: 1
                      isbn: "978-0-439-13959-1"
                      title: "Harry Potter and the Philosopher's Stone"
                      author: "J.K. Rowling"
                      coverUrl: "https://example.com/cover.jpg"
                      ratingAvg: 4.5
                      description: "The first novel in the Harry Potter series"
                      releaseDate: 1997
                externalResults:
                  summary: Results from Open Library API
                  value:
                    - id: 0
                      isbn: ""
                      title: "Harry Potter and the Order of the Phoenix"
                      author: "J.K. Rowling"
                      coverUrl: ""
                      ratingAvg: 0
                      description: ""
                      releaseDate: 2003
        '400':
          description: Bad request - missing query parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Query parameter 'q' is required"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                databaseError:
                  summary: Database search error
                  value:
                    error: "Error searching in database: connection refused"
                externalApiError:
                  summary: Open Library API error
                  value:
                    error: "Error searching in Open Library: timeout"

  /user/reset-password:
    post:
      summary: Reset user password
      description: Reset password for a user with email verification and security answer
      operationId: resetPassword
      tags:
        - User
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
            example:
              email: "user@example.com"
              securityAnswer: "answer"
              newPassword: "NewSecurePassword123"
      responses:
        '200':
          description: Password reset successfully
        '400':
          description: Bad request - invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - invalid email or security answer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /health:
    get:
      summary: Health check
      description: Check if the API is running and healthy
      operationId: healthCheck
      tags:
        - Health
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
              example:
                status: ok

components:
  schemas:
    Book:
      type: object
      description: A book object containing metadata
      required:
        - id
        - title
        - author
      properties:
        id:
          type: integer
          format: int64
          description: Unique identifier for the book (0 if from external API)
          example: 1
        isbn:
          type: string
          description: ISBN identifier (may be empty for external API results)
          example: "978-0-439-13959-1"
        title:
          type: string
          description: Book title
          example: "Harry Potter and the Philosopher's Stone"
        author:
          type: string
          description: Primary author name
          example: "J.K. Rowling"
        coverUrl:
          type: string
          description: URL to book cover image (may be empty)
          example: "https://covers.openlibrary.org/b/id/7245156-M.jpg"
        ratingAvg:
          type: number
          format: float
          description: Average rating (0 if not available)
          example: 4.5
        description:
          type: string
          description: Book description or summary (may be empty)
          example: "The first novel in the Harry Potter series follows Harry Potter, a young wizard who discovers his magical heritage on his eleventh birthday."
        releaseDate:
          type: integer
          format: int64
          description: Publication year or Unix timestamp
          example: 1997

    ErrorResponse:
      type: object
      description: Standard error response
      required:
        - error
      properties:
        error:
          type: string
          description: Error message describing what went wrong
          example: "Query parameter 'q' is required"

    ResetPasswordRequest:
      type: object
      description: Request payload for resetting a user password
      required:
        - email
        - securityAnswer
        - newPassword
      properties:
        email:
          type: string
          format: email
          description: User email address
          example: "user@example.com"
        securityAnswer:
          type: string
          description: Answer to the security question
          example: "answer"
        newPassword:
          type: string
          format: password
          description: New password (minimum 12 characters)
          minLength: 12
          example: "NewSecurePassword123"
